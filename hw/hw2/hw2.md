## 1.
### (1)
应该为16字节。
### (2)
假设写缓冲区的一个条目为16字节（和L2缓存总线宽度一致），那么对于合并写缓冲区，可以将2个8B的写请求合并在一个条目中，而非合并写缓冲区的一个16字节条目只能存储一个8B的写请求。因此，合并写缓冲区每4个周期可以向L2缓存写入16字节数据，而非合并写缓冲区每4个周期只能向L2缓存写入8字节（有效）数据。稳定状态下写入速度取决于写缓冲区的写速度，因此合并写缓冲区的加速比为2倍。
### (3)
采用阻塞缓存时，如果发生缺失，后续的指令会停顿，而写缓冲区大小与L1缺失率无关，因此L1缓存缺失对写缓冲区条目没有影响。而采用非阻塞缓存时，如果发生缺失，剩下的指令可以继续执行，（相比阻塞缓存）可能会有更多的写入指令，因此写缓冲区可以大一些。

## 2.
### (1)
同时在L2缓存和主存中查找所需要的块。如果L2缓存命中，那么直接从L2缓存中调入数据；如果L2缓存未命中，那么从主存调入数据同时放入L2缓存和L1缓存，这里如果L2缓存被换出的块是L1中存在的块，那么L1中对应块也需要被换出。
### (2)
如果L2命中，那么将这一块调入L1，将L1中对应的块换到L2（即互换L1和L2中的块）；如果L2未命中，那么直接将主存中对应的块调入L1，L1中被换出的块移到L2，此时可能导致L2中的块被换出。
### (3)
- 对于包含式：
  - 如果L2命中，L1中的块是脏块，由于L2包含L1，因此直接将这一块的内容写回到L2中对应位置即可
  - 如果L2 miss，L1被换出的块是脏块，L2被换出的不是脏块，那么需要将L1中的脏块写回到L2中对应位置。这里如果恰好被换出的两块是相同的，那么L1被换出的内容需要写回到主存中。
  - 如果L2 miss，L1被换出的块是脏块，L2被换出的也是脏块，那么需要将L1中的脏块写回到L2中对应位置，同时将L2中的脏块写回到主存中。这里如果恰好被换出的两块是相同的，由于L1中的内容肯定是最新的，因此只需要将L1中的内容写回到主存中；如果两块不同，但L2被换出的块恰好在L1中存在，
  - 如果L2 miss，L1中被换出的块不是脏块，L2中被换出的是脏块，只需要将L2中的脏块写回到主存中即可。
- 对于互斥式：
  - 如果L2命中，L1中的块是脏块，由于它被换到了L2，因此不需要额外操作。
  - 如果L2 miss，由于L1中的块被写到L2，因此只需要考虑L2可能被换出的块。如果L2被换出的是脏块，那么需要将L2中的脏块写回到主存中。

## 3.
由所给条件可知，将64B数据写至闪存需要$2.56\mu J$能量，因此休眠开始时将8GB数据写入闪存需要$320J$能量，休眠结束后将数据从闪存读取至DRAM也需要$320J$能量。因此系统需要空闲超过$\frac{640J}{1.6W} = 400s$才能从休眠中获益。
这里由于读写至DRAM的能量消耗远小于读写至缓存，因此忽略从休眠中恢复时读写至DRAM的能量消耗。另外为了方便，认为$1G=10^9$。

## 4.
### (1)
当L1数据缓存缺失，L2缓存命中时，需要从L2缓存中读取32字节进入L1缓存，即需要从266MHz总线传输2个128位字，需要的时间为$15ns + 2*\frac{1}{266MHz} = \frac{1}{133}\mu s = 22.519ns$

当L1，L2缓存均缺失时，需要从主存储器读取64字节进入L2缓存，再从L2缓存读入L1缓存。即需要从133MHz的主存储器总线读取4个128位字，如果不是脏块，则这一部分需要的时间为$4*\frac{1}{133MHz} + 60ns = 90.075ns$，脏块所需时间还要翻倍。

因此平均访问时间为$2\%\times(22.519ns+20\%\times(90.075ns + 0.5\times 90.075ns)) = 0.99ns$

### (2)
当L1数据缓存缺失，L2缓存命中时，只需要从L2缓存读取16字节，即一个128位字（由于L1数据缓存是直写的，因此不会有脏块）。这一部分平均时间为$15ns + \frac{1}{266MHz} = 18.759ns$

当L1缓存和L2缓存均缺失时，需要先从主存读取64字节进入L2缓存，再读到L1缓存。这一部分的计算和上面相同。

平均访问时间为$5\%\times(18.759ns+20\%\times(90.075ns + 0.5\times 90.075ns)) = 2.29ns$。

### (3)
先计算不考虑写入缓冲区的情况下，写入操作直达L2缓存的平均代价。由于L2缓存总线一个周期可以传输一个128位字，因此当L2缓存命中时，所有的写指令都可以用一个（L2总线的）周期完成写入，代价为$15ns + \frac{1}{266MHz} = 18.759ns$。

当L2缓存缺失时，需要先将对应的数据块换入到L2缓存，再进行写入。计算过程同样与上面一致。

因此，不考虑写缓冲区时，平均代价为$18.759ns+20\%\times (90.075ns + 0.5\times 90.075ns) = 45.782ns$

由于写缓冲区可以消除$95\%$的CPU写停顿，因此平均代价为$45.782ns\times 0.05 = 2.29ns$

### (4)
CPU频率为1.1GHz，因此一个周期为$\frac{1}{1.1GHz} = 0.909ns$。考虑存储器访问时，一条指令平均需要的运行时间为$1.35*0.909ns + 0.99ns + 20\%\times 2.29ns + 10\%\times 2.29ns = 2.586ns$，即平均需要$\frac{2.586}{0.909}\simeq 3.19$周期。CPI即为$3.19$。